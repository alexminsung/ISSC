---
title: "DataFest 2020 - Homeless"
output: slidy_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r message = FALSE, echo = FALSE}
library(shiny)
library(shinydashboard)
library(tidyverse)
library(ggplot2)

#Reading the csv
shelterData <- read.csv("https://raw.githubusercontent.com/alexminsung/ISSC/master/data/Daily%20shelter%20occpancy%20current.csv?token=APUVSRCQBS7QDHDGTMGCLMS65JGQU")
attach(shelterData)

shelterData %>% 
  distinct(SHELTER_NAME)

# Finds all rows that starts witih "HFS"
HFS <- grep("^HFS", as.character(shelterData$SHELTER_NAME), value = TRUE)

# List of shelters with COVID19 cases
target <- c("COSTI Reception Centre", "Seaton House", HFS, "Salvation Army - Maxwell Meighen", 
            "SVDP - Mary's Home", "Robertson House")

# Filters the data by reported Covid19 cases
shelterByCovid <- shelterData %>%
  filter(as.character(SHELTER_NAME) %in% target)
  
#How Does shelterByCovid filter out the locations to only include the the locations that have COVID-19?


```

Qs: The effects of covid19 on homeless shelters/homeless?
- but how does an increase in occupancy in shelter a impact the society (societal impact)?
- the numbers are obviously going to increase because non-essential travels are restricted and homeless are more likely to be in shelters
- there are possible health impacts...

1. try to sort the data to include 14 days period before the reported case
2. (if possible) compare it to the reported case around the region at the time of the reported case (or couple days after)
  - want to see if these shelters acted as a hotspot


ASSUMPTIONS:

1) ALthough we recognize that the first publicly reported case of COVID-19 can be dated back to November 2019, for the purpose of this project, anything including and after March 23 2020 will be ccounted as "during COVID-19". While anything prior to March 23 2020 will be considered prior to COVID-19.


```{r echo = FALSE}
#I have separated the data by sector as you suggested but even then the points are very messy. If you can think of a way to 
# improve this, then go ahead

shelterData %>%
  filter(as.character(SECTOR) == "Co-ed" & as.character(OCCUPANCY_DATE) > "2020-03-01T00:00:00") %>%
  ggplot(aes(x = OCCUPANCY_DATE, y = OCCUPANCY, color = SHELTER_NAME)) + facet_wrap(SHELTER_CITY~ORGANIZATION_NAME) + geom_point()

shelterData %>%
  filter(as.character(SECTOR) == "Families" & as.character(OCCUPANCY_DATE) > "2020-03-01T00:00:00") %>%
  ggplot(aes(x = OCCUPANCY_DATE, y = OCCUPANCY, color = SHELTER_NAME)) + facet_wrap(SHELTER_CITY~ORGANIZATION_NAME) + geom_point() + theme(axis.text.x = element_text(angle=90, hjust=0))

shelterData %>%
  filter(as.character(SECTOR) == "Women" & as.character(OCCUPANCY_DATE) > "2020-03-01T00:00:00") %>%
  ggplot(aes(x = OCCUPANCY_DATE, y = OCCUPANCY, color = SHELTER_NAME)) + facet_wrap(SHELTER_CITY~ORGANIZATION_NAME) + geom_point() + theme(axis.text.x = element_text(angle=90, hjust=0))

shelterData %>%
  filter(as.character(SECTOR) == "Men" & as.character(OCCUPANCY_DATE) > "2020-03-01T00:00:00") %>%
  ggplot(aes(x = OCCUPANCY_DATE, y = OCCUPANCY, color = SHELTER_NAME)) + facet_wrap(SHELTER_CITY~ORGANIZATION_NAME) + geom_point() + theme(axis.text.x = element_text(angle=90, hjust=0))

shelterData %>%
  filter(as.character(SECTOR) == "Men" & as.character(OCCUPANCY_DATE) > "2020-03-01T00:00:00") %>%
  ggplot(aes(x = OCCUPANCY_DATE, y = OCCUPANCY, color = SHELTER_NAME)) + facet_wrap(SHELTER_CITY~ORGANIZATION_NAME) + geom_point() + theme(axis.text.x = element_text(angle=90, hjust=0))

shelterData %>%
  filter(as.character(SECTOR) == "Youth" & as.character(OCCUPANCY_DATE) > "2020-03-01T00:00:00") %>%
  ggplot(aes(x = OCCUPANCY_DATE, y = OCCUPANCY, color = SHELTER_NAME)) + facet_wrap(SHELTER_CITY~ORGANIZATION_NAME) + geom_point() + theme(axis.text.x = element_text(angle=90, hjust=0))
  
```

```{r echo = FALSE}
# this is on the side, since i wanted to see if the numbers dropped after a covid19 case was reported on some of these shelters
shelterByCovid %>%
  filter(as.character(OCCUPANCY_DATE) > "2020-03-01T00:00:00" & as.character(ORGANIZATION_NAME) == "Homes First Society") %>%
  mutate(log_occupancy = log(OCCUPANCY)) %>%
  ggplot(aes(x = OCCUPANCY_DATE, y = OCCUPANCY, color = SHELTER_NAME)) + geom_point() + 
  facet_wrap(~ORGANIZATION_NAME) +
  geom_vline(aes(xintercept = as.character(OCCUPANCY_DATE) == "2020-05-22T00:00:00"), color="black", linetype="dashed") + 
  theme(axis.text.x = element_text(angle=90, hjust=0))

```






```{r echo=FALSE}

library(loon)
library(loon.data)
#data(shelterData)
data(igg1)
summary(igg1)
summary(shelterData)
library(loon.ggplot)
#This is me trying to replicate the results with our dataset
atom_info <- with(shelterData,
                  paste0(OCCUPANCY_DATE, "_", name, "\n",
                         "CAPACITY", Capacity, "\n",
                         "SECTOR", Sector, "\n",
                         "X_id", ID)
)


#This is me trying to replicate the results with our dataset
atom_info <- with(shelterData,
                  paste0(OCCUPANCY_DATE, "\n",
                         "CAPACITY", Capacity, "\n",
                         "SECTOR", Sector, "\n",
                         "X_id", ID)
)


#THIS IS THE CODE I was trying from
atom_info <- with(igg1,
                  paste0(recordType, ": ",  name, "\n",        # Note newline characters
                         "Residue: ", residue, "\n",
                         "Residue Name: ", residueName, "\n",
                         "Group: ", group, "\n",
                         "Chain ID: ",  chainID)
)


#This was me messing aruond with the code
p3d <- with(igg1,
            l_plot3D(x = x, y = y, z = z,
                     # Rest of arguments are as in l_plot()
                     itemLabel = atom_info,
                     showItemLabels = FALSE,  # <- show tool tips?
                     showLabels = TRUE,       # <- show axis labels and title?
                     showGuides = TRUE,   
                     linkingGroup = "igg1",
                     title = "human IgG1 molecule")
)
```


"hello"




```{r echo=FALSE}
#TRYING MY STUFF OUT TO DETERMINE A LINEAR REGRESSION MODEL

#First get an unfiltered view of the raw data:
attach(shelterData)
view(shelterData)

#The PURPOSE of this report is to see whether there is a change in the number Occupancy.
# $H_{0}$: There is no significant change in the occupancy after the lockdown in Toronto (i.e. March 17)
# $H_{1}$: There is a significant change in the occupancy after the lockdown in Toronto
#We will be using a significance level of 5% (i.e. 0.05) (Do you think 5% is reasonable?)

#QUESTION FOR ALEX: SHOULD WE CHANGE THE DATE OF THE LOCKDOWN FROM MARCH 17TH TO MARCH 24TH OR MARCH 30TH?????

boxplot(OCCUPANCY, main = "9839 Boxplot Boxplot", ylab = "Occupancy Number")
#From this plot it can be seen that the data is very volatile, beacuse there is a significant portion of the data outside of the whiskers

shelterData %>%
  ggplot(aes(x = OCCUPANCY_DATE, y = OCCUPANCY)) + geom_point()

#Find a way to include Shape, and color for this gg-plot (Notice: that it should be shape = SHELTER_NAME)

#It can be noticed through the gg-plot that two shelters had a dramtic decrease in Occupancy as time progressed. While the other shelters either decreased a little bit as time progressed or increased a little bit as time progressed or basically stated the same.

#We are now going to create a regression line with occupancy on the y-axis and occupancy date on the x-axis to see if the data behaves normally
#shelterData %>%
qqnorm(shelterData$OCCUPANCY, ylab = "Occupancy", main = "Hello")
qqline(shelterData$OCCUPANCY)

#From the graph it can be seen that this variable is not normal, because it does not closely follow the regression line.

#Applying a log transformation to the Response Variable Occupancy:
OCCUPANCY <- as.numeric(OCCUPANCY)
#Problem when converting values from 0 to lo10(0), because log10(0) give negative infintity
qqnorm(log10(shelterData$OCCUPANCY), cex=0.5, ylab = "Log to base 10 of Sale Price", main = "9839")
qqline(log10(shelterData$OCCUPANCY))




#APPLYING A SQRT transformation to the response variable
qqnorm(sqrt(shelterData$OCCUPANCY), cex=0.5, ylab = "Square Root of Occupancy", main = "9839 Sqrt")
qqline(sqrt(shelterData$OCCUPANCY))


#Applying an inverse transformation to the response variable
qqnorm((1 / (shelterData$OCCUPANCY)), cex=0.5, ylab = "Inverse of Occupancy", main = "9839 INverse")
qqline(1 /(shelterData$OCCUPANCY))
```

